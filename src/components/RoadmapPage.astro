---
import { t, type Lang } from '../i18n/utils';
import { ui } from '../i18n/ui';

interface Props {
    lang?: Lang;
}

const { lang = 'es' } = Astro.props;
const home = lang === 'en' ? `${import.meta.env.BASE_URL}en/` : import.meta.env.BASE_URL;
const rd = ui[lang].roadmap;
---

<section class="roadmap-page">
    <!-- Hero -->
    <div class="roadmap-hero">
        <div class="section-header">
            <h1 class="hero-title">{rd.heroTitle} <span class="highlight-brick">{rd.heroHighlight}</span></h1>
            <div class="section-line"></div>
        </div>
        <p class="hero-subtitle" set:html={rd.heroSubtitle} />
    </div>

    <!-- Timeline -->
    <div class="roadmap-layout">
        <main class="timeline-container">
            <div class="timeline">

                <!-- FASE A: COMPLETADA -->
                <div class="timeline-item" id="fase-a">
                    <div class="timeline-node node-completed"></div>
                    <div class="timeline-connector"></div>

                    <div class="timeline-card card-completed">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseA}</span>
                                <h2 class="card-title">{rd.phaseATitle}</h2>
                            </div>
                            <div class="status-badge badge-completed">
                                <svg class="badge-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                                </svg>
                                {rd.badgeCompleted}
                            </div>
                        </div>
                        <p class="card-description">{rd.phaseADesc}</p>
                        <ul class="checklist">
                            {rd.phaseAItems.map((item: string) => (
                                <li class="check-item check-done">
                                    <span class="check-mark">[x]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- FASE B: COMPLETADA -->
                <div class="timeline-item" id="fase-b">
                    <div class="timeline-node node-completed"></div>
                    <div class="timeline-connector"></div>

                    <div class="timeline-card card-completed">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseB}</span>
                                <h2 class="card-title">{rd.phaseBTitle}</h2>
                            </div>
                            <div class="status-badge badge-completed">
                                <svg class="badge-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                                </svg>
                                {rd.badgeCompleted}
                            </div>
                        </div>
                        <p class="card-description">{rd.phaseBDesc}</p>
                        <ul class="checklist">
                            {rd.phaseBItems.map((item: string) => (
                                <li class="check-item check-done">
                                    <span class="check-mark">[x]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- FASE C: COMPLETADA -->
                <div class="timeline-item" id="fase-c">
                    <div class="timeline-node node-completed"></div>
                    <div class="timeline-connector"></div>

                    <div class="timeline-card card-completed">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseC}</span>
                                <h2 class="card-title">{rd.phaseCTitle}</h2>
                            </div>
                            <div class="status-badge badge-completed">
                                <svg class="badge-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                                </svg>
                                {rd.badgeCompleted}
                            </div>
                        </div>
                        <p class="card-description">{rd.phaseCDesc}</p>
                        <ul class="checklist">
                            {rd.phaseCItems.map((item: string) => (
                                <li class="check-item check-done">
                                    <span class="check-mark">[x]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- FASE D: COMPLETADA -->
                <div class="timeline-item" id="fase-d">
                    <div class="timeline-node node-completed"></div>
                    <div class="timeline-connector"></div>

                    <div class="timeline-card card-completed">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseD}</span>
                                <h2 class="card-title">{rd.phaseDTitle}</h2>
                            </div>
                            <div class="status-badge badge-completed">
                                <svg class="badge-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                                </svg>
                                {rd.badgeCompleted}
                            </div>
                        </div>
                        <p class="card-description">{rd.phaseDDesc}</p>
                        <ul class="checklist">
                            {rd.phaseDItems.map((item: string) => (
                                <li class="check-item check-done">
                                    <span class="check-mark">[x]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- HITO MAYOR: v1.0.0 — CONSEGUIDO -->
                <div class="timeline-item timeline-milestone" id="hito-v1">
                    <div class="timeline-node node-milestone node-milestone-done"></div>
                    <div class="timeline-connector"></div>

                    <div class="milestone-card milestone-card-done">
                        <svg class="milestone-checkmark" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                        </svg>

                        <div class="milestone-content">
                            <div class="milestone-info milestone-info-done">
                                <svg class="milestone-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                                <div>
                                    <span class="milestone-label">{rd.milestoneLabel}</span>
                                    <h3 class="milestone-title">{rd.milestoneTitle}</h3>
                                </div>
                            </div>
                            <div class="milestone-badge milestone-badge-done">
                                {rd.milestoneBadge}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ESTABILIZACIÓN -->
                <div class="timeline-item" id="estabilizacion">
                    <div class="timeline-node node-active"></div>
                    <div class="timeline-connector"></div>

                    <div class="stabilization-card">
                        <div class="stabilization-info">
                            <span class="stabilization-label">{rd.stabilizationLabel}</span>
                            <h2 class="stabilization-title">{rd.stabilizationTitle}</h2>
                            <p class="stabilization-description">{rd.stabilizationDesc}</p>
                            <div class="stabilization-badge">
                                <span class="stabilization-pulse"></span>
                                {rd.badgeMonitoring}
                            </div>
                        </div>

                        <div class="stabilization-gauge">
                            <div class="gauge-container">
                                <svg viewBox="0 0 100 50" class="gauge-svg">
                                    <path d="M 10 50 A 40 40 0 0 1 30 15.35" fill="none" stroke="var(--arch-brick)" stroke-width="12" stroke-linecap="butt" />
                                    <path d="M 30 15.35 A 40 40 0 0 1 70 15.35" fill="none" stroke="#FACC15" stroke-width="12" stroke-linecap="butt" />
                                    <path d="M 70 15.35 A 40 40 0 0 1 90 50" fill="none" stroke="#10B981" stroke-width="12" stroke-linecap="butt" />
                                    <g class="gauge-needle">
                                        <polygon points="47,50 53,50 50,8" fill="var(--arch-ink)" />
                                    </g>
                                    <circle cx="50" cy="50" r="7" fill="var(--arch-ink)" />
                                    <circle cx="50" cy="50" r="3" fill="var(--arch-surface)" />
                                </svg>
                                <div class="gauge-baseline"></div>
                            </div>
                            <div class="gauge-label">{rd.gaugeLabel}</div>
                        </div>
                    </div>
                </div>

                <!-- FASE E -->
                <div class="timeline-item" id="fase-e">
                    <div class="timeline-node node-planned"></div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-card card-planned">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseE}</span>
                                <h2 class="card-title">{rd.phaseETitle}</h2>
                            </div>
                            <div class="status-badge badge-planned">{rd.badgePlanned}</div>
                        </div>
                        <p class="card-description">{rd.phaseEDesc}</p>
                        <ul class="checklist">
                            {rd.phaseEItems.map((item: string) => (
                                <li class="check-item check-pending">
                                    <span class="check-mark">[ ]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- FASE F -->
                <div class="timeline-item" id="fase-f">
                    <div class="timeline-node node-planned"></div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-card card-planned">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseF}</span>
                                <h2 class="card-title">{rd.phaseFTitle}</h2>
                            </div>
                            <div class="status-badge badge-planned">{rd.badgePlanned}</div>
                        </div>
                        <p class="card-description">{rd.phaseFDesc}</p>
                        <ul class="checklist">
                            {rd.phaseFItems.map((item: string) => (
                                <li class="check-item check-pending">
                                    <span class="check-mark">[ ]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- FASE G -->
                <div class="timeline-item" id="fase-g">
                    <div class="timeline-node node-planned"></div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-card card-planned">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseG}</span>
                                <h2 class="card-title">{rd.phaseGTitle}</h2>
                            </div>
                            <div class="status-badge badge-planned">{rd.badgePlanned}</div>
                        </div>
                        <p class="card-description">{rd.phaseGDesc}</p>
                        <ul class="checklist">
                            {rd.phaseGItems.map((item: string) => (
                                <li class="check-item check-pending">
                                    <span class="check-mark">[ ]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- FASE H -->
                <div class="timeline-item" id="fase-h">
                    <div class="timeline-node node-planned"></div>
                    <div class="timeline-connector"></div>
                    <div class="timeline-card card-planned">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.phaseH}</span>
                                <h2 class="card-title">{rd.phaseHTitle}</h2>
                            </div>
                            <div class="status-badge badge-planned">{rd.badgePlanned}</div>
                        </div>
                        <p class="card-description">{rd.phaseHDesc}</p>
                        <ul class="checklist">
                            {rd.phaseHItems.map((item: string) => (
                                <li class="check-item check-pending">
                                    <span class="check-mark">[ ]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

                <!-- FUTURO -->
                <div class="timeline-item" id="futuro">
                    <div class="timeline-node node-future"></div>
                    <div class="timeline-card card-future">
                        <div class="card-header">
                            <div>
                                <span class="card-phase">{rd.future}</span>
                                <h2 class="card-title">{rd.futureTitle}</h2>
                            </div>
                            <div class="status-badge badge-future">{rd.badgeFuture}</div>
                        </div>
                        <p class="card-description">{rd.futureDesc}</p>
                        <ul class="checklist">
                            {rd.futureItems.map((item: string) => (
                                <li class="check-item check-future">
                                    <span class="check-mark">[?]</span>
                                    <span set:html={item} />
                                </li>
                            ))}
                        </ul>
                    </div>
                </div>

            </div>

            <!-- CTA -->
            <div class="roadmap-cta">
                <h3 class="cta-title">{rd.ctaTitle}</h3>
                <p class="cta-description">{rd.ctaDesc}</p>
                <a href="https://github.com/Diego303/architect-cli/issues" target="_blank" class="cta-button">
                    <svg class="cta-icon" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                    </svg>
                    {rd.ctaButton}
                </a>
            </div>
        </main>

        <!-- Sidebar TOC -->
        <aside class="roadmap-toc">
            <div class="toc-content">
                <div class="toc-header">
                    <span class="toc-title">{rd.tocTitle}</span>
                </div>
                <nav class="toc-nav">
                    <ul class="toc-list">
                        <li>
                            <a href={home} class="toc-item toc-back">
                                <svg class="back-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                </svg>
                                {rd.tocBack}
                            </a>
                        </li>
                        <li><a href="#fase-a" class="toc-item" data-slug="fase-a"><span class="toc-dot toc-dot-completed"></span>{rd.tocPhaseA}</a></li>
                        <li><a href="#fase-b" class="toc-item" data-slug="fase-b"><span class="toc-dot toc-dot-completed"></span>{rd.tocPhaseB}</a></li>
                        <li><a href="#fase-c" class="toc-item" data-slug="fase-c"><span class="toc-dot toc-dot-completed"></span>{rd.tocPhaseC}</a></li>
                        <li><a href="#fase-d" class="toc-item" data-slug="fase-d"><span class="toc-dot toc-dot-completed"></span>{rd.tocPhaseD}</a></li>
                        <li><a href="#hito-v1" class="toc-item" data-slug="hito-v1"><span class="toc-dot toc-dot-milestone"></span>{rd.tocMilestone}</a></li>
                        <li><a href="#estabilizacion" class="toc-item" data-slug="estabilizacion"><span class="toc-dot toc-dot-active"></span>{rd.tocStabilization}</a></li>
                        <li><a href="#fase-e" class="toc-item" data-slug="fase-e"><span class="toc-dot toc-dot-planned"></span>{rd.tocPhaseE}</a></li>
                        <li><a href="#fase-f" class="toc-item" data-slug="fase-f"><span class="toc-dot toc-dot-planned"></span>{rd.tocPhaseF}</a></li>
                        <li><a href="#fase-g" class="toc-item" data-slug="fase-g"><span class="toc-dot toc-dot-planned"></span>{rd.tocPhaseG}</a></li>
                        <li><a href="#fase-h" class="toc-item" data-slug="fase-h"><span class="toc-dot toc-dot-planned"></span>{rd.tocPhaseH}</a></li>
                        <li><a href="#futuro" class="toc-item" data-slug="futuro"><span class="toc-dot toc-dot-future"></span>{rd.tocFuture}</a></li>
                    </ul>
                </nav>
            </div>
        </aside>
    </div>
</section>

<script>
    document.addEventListener('astro:page-load', () => {
        const tocLinks = document.querySelectorAll<HTMLAnchorElement>('.roadmap-toc .toc-item[data-slug]');
        if (!tocLinks.length) return;

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        tocLinks.forEach(link => link.classList.remove('active'));
                        const activeLink = document.querySelector<HTMLAnchorElement>(
                            `.roadmap-toc .toc-item[data-slug="${entry.target.id}"]`
                        );
                        if (activeLink) activeLink.classList.add('active');
                    }
                });
            },
            { rootMargin: '-80px 0px -60% 0px', threshold: 0 }
        );

        tocLinks.forEach(link => {
            const slug = link.dataset.slug;
            if (slug) {
                const section = document.getElementById(slug);
                if (section) observer.observe(section);
            }
        });
    });
</script>

<style>
    /* ============================================
       PAGE LAYOUT
       ============================================ */
    .roadmap-page {
        max-width: 80rem;
        margin: 0 auto;
        width: 100%;
    }

    /* ============================================
       HERO
       ============================================ */
    .roadmap-hero {
        padding: 3rem 1.5rem 2rem;
        border-bottom: 2px solid var(--arch-line);
        text-align: center;
    }

    @media (min-width: 1024px) {
        .roadmap-hero {
            text-align: left;
        }
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 1rem;
    }

    .hero-title {
        font-family: var(--font-heading);
        font-size: 2.25rem;
        color: var(--arch-ink);
        font-weight: 800;
        margin: 0;
        white-space: nowrap;
    }

    .highlight-brick {
        position: relative;
        display: inline-block;
        color: var(--arch-brick);
    }

    .highlight-brick::after {
        content: '';
        position: absolute;
        bottom: 4px;
        left: 0;
        width: 100%;
        height: 8px;
        background-color: var(--arch-brick-transparent);
        z-index: -1;
        transform: skewX(-15deg);
    }

    .section-line {
        height: 4px;
        background-color: var(--arch-ink);
        flex-grow: 1;
    }

    .hero-subtitle {
        font-size: 1.125rem;
        color: var(--arch-ink-light);
        line-height: 1.6;
        margin: 0;
        max-width: 60ch;
    }

    .hero-subtitle code {
        font-family: var(--font-mono);
        color: var(--arch-brick);
        background-color: var(--arch-shape);
        padding: 0.15em 0.4em;
        border-radius: 3px;
        font-size: 0.9em;
    }

    /* ============================================
       LAYOUT (timeline + toc)
       ============================================ */
    .roadmap-layout {
        display: flex;
        flex-direction: column;
    }

    @media (min-width: 1024px) {
        .roadmap-layout {
            flex-direction: row;
        }
    }

    .timeline-container {
        flex: 1;
        min-width: 0;
        padding: 2.5rem 1.5rem 4rem;
    }

    @media (min-width: 1024px) {
        .timeline-container {
            padding: 2.5rem 3rem 4rem;
        }
    }

    /* ============================================
       TIMELINE
       ============================================ */
    .timeline {
        position: relative;
        padding-left: 2rem;
        margin-left: 0.75rem;
    }

    /* Vertical line */
    .timeline::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background-color: var(--arch-ink);
    }

    /* ============================================
       TIMELINE ITEMS
       ============================================ */
    .timeline-item {
        position: relative;
        padding-bottom: 3rem;
        scroll-margin-top: 6rem;
    }

    .timeline-item:last-child {
        padding-bottom: 0;
    }

    /* Nodes on the line */
    .timeline-node {
        position: absolute;
        left: -2.75rem;
        top: 0.5rem;
        width: 1.5rem;
        height: 1.5rem;
        border: 4px solid var(--arch-ink);
        z-index: 2;
    }

    .node-completed {
        background-color: var(--arch-ink);
    }

    .node-active {
        background-color: var(--arch-brick);
        animation: pulse-border 2s infinite;
    }

    @keyframes pulse-border {
        0% { box-shadow: 0 0 0 0 rgba(200, 90, 50, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(200, 90, 50, 0); }
        100% { box-shadow: 0 0 0 0 rgba(200, 90, 50, 0); }
    }

    .node-planned {
        background-color: var(--arch-paper);
    }

    .node-future {
        background-color: var(--arch-shape);
        border-style: dashed;
        border-color: var(--arch-ink-light);
    }

    /* Horizontal connector */
    .timeline-connector {
        position: absolute;
        left: -1.25rem;
        top: calc(0.5rem + 0.5rem);
        width: 1.25rem;
        height: 4px;
        background-color: var(--arch-ink);
    }

    .timeline-item:last-child .timeline-connector {
        background-color: transparent;
        border-top: 4px dashed var(--arch-ink-light);
    }

    /* ============================================
       TIMELINE CARDS
       ============================================ */
    .timeline-card {
        border: 2px solid var(--arch-ink);
        padding: 1.5rem;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    @media (min-width: 768px) {
        .timeline-card {
            padding: 2rem;
        }
    }

    .timeline-card:hover {
        transform: translate(-2px, -2px);
    }

    .card-completed {
        background-color: var(--arch-surface);
        box-shadow: var(--shadow-draft);
    }

    .card-completed:hover {
        box-shadow: 8px 8px 0px 0px rgba(41, 37, 36, 1);
    }

    .card-active {
        background-color: var(--arch-surface);
        box-shadow: var(--shadow-draft);
    }

    .card-active:hover {
        box-shadow: 8px 8px 0px 0px rgba(41, 37, 36, 1);
    }

    .card-planned {
        background-color: var(--arch-paper);
        box-shadow: var(--shadow-draft);
        opacity: 0.92;
    }

    .card-planned:hover {
        opacity: 1;
        box-shadow: 8px 8px 0px 0px rgba(41, 37, 36, 1);
    }

    .card-future {
        background-color: var(--arch-shape);
        border-style: dashed;
        border-color: var(--arch-ink-light);
        opacity: 0.8;
    }

    .card-future:hover {
        opacity: 0.95;
    }

    /* Card header */
    .card-header {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    @media (min-width: 640px) {
        .card-header {
            flex-direction: row;
            align-items: flex-start;
            justify-content: space-between;
        }
    }

    .card-phase {
        display: block;
        font-family: var(--font-mono);
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--arch-brick);
        margin-bottom: 0.25rem;
    }

    .card-future .card-phase {
        color: var(--arch-ink-light);
    }

    .card-title {
        font-family: var(--font-heading);
        font-size: 1.375rem;
        font-weight: 800;
        color: var(--arch-ink);
        text-transform: uppercase;
        letter-spacing: 0.02em;
        margin: 0;
        line-height: 1.2;
    }

    .card-future .card-title {
        color: var(--arch-ink-light);
    }

    .card-description {
        font-family: var(--font-body);
        font-size: 0.9375rem;
        color: var(--arch-ink-light);
        line-height: 1.6;
        margin: 0 0 1.25rem 0;
    }

    /* ============================================
       STATUS BADGES
       ============================================ */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: 2px solid var(--arch-ink);
        padding: 0.25rem 0.75rem;
        font-family: var(--font-mono);
        font-size: 0.6875rem;
        font-weight: 700;
        white-space: nowrap;
        flex-shrink: 0;
    }

    .badge-completed {
        background-color: var(--arch-ink);
        color: var(--arch-paper);
    }

    .badge-icon {
        width: 0.875rem;
        height: 0.875rem;
    }

    .badge-active {
        background-color: var(--arch-paper);
        color: var(--arch-ink);
    }

    .spinner {
        width: 0.75rem;
        height: 0.75rem;
        border: 2px solid var(--arch-line);
        border-top-color: var(--arch-brick);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .badge-planned {
        background-color: var(--arch-surface);
        color: var(--arch-ink-light);
    }

    .badge-future {
        background-color: var(--arch-paper);
        color: var(--arch-ink-light);
        border-color: var(--arch-ink-light);
        border-style: dashed;
    }

    /* ============================================
       CHECKLIST
       ============================================ */
    .checklist {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .check-item {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        font-family: var(--font-mono);
        font-size: 0.8125rem;
        line-height: 1.5;
        color: var(--arch-ink);
    }

    .check-mark {
        flex-shrink: 0;
        font-weight: 700;
        margin-top: 1px;
    }

    .check-done .check-mark {
        color: var(--arch-ink);
    }

    .check-progress .check-mark {
        color: var(--arch-brick);
    }

    .check-pending .check-mark {
        color: var(--arch-ink-light);
    }

    .check-future .check-mark {
        color: var(--arch-ink-light);
    }

    .check-future {
        color: var(--arch-ink-light);
        opacity: 0.75;
    }

    .check-item strong {
        font-weight: 700;
    }

    .check-done strong {
        background-color: rgba(41, 37, 36, 0.06);
        padding: 0 0.25rem;
    }

    .check-progress strong {
        background-color: var(--arch-brick-transparent);
        padding: 0 0.25rem;
    }

    .check-item code {
        font-family: var(--font-mono);
        color: var(--arch-brick);
        background-color: var(--arch-shape);
        padding: 0.1em 0.3em;
        border-radius: 2px;
        font-size: 0.85em;
    }

    /* ============================================
       CTA
       ============================================ */
    .roadmap-cta {
        margin-top: 3rem;
        background-color: var(--arch-surface);
        border: 2px solid var(--arch-ink);
        box-shadow: var(--shadow-draft);
        padding: 2rem;
        text-align: center;
    }

    .cta-title {
        font-family: var(--font-heading);
        font-size: 1.375rem;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--arch-ink);
        margin: 0 0 0.5rem 0;
    }

    .cta-description {
        font-family: var(--font-body);
        font-size: 0.9375rem;
        color: var(--arch-ink-light);
        margin: 0 0 1.5rem 0;
    }

    .cta-button {
        display: inline-flex;
        align-items: center;
        gap: 0.625rem;
        background-color: var(--arch-brick);
        color: var(--arch-surface);
        border: 2px solid var(--arch-ink);
        padding: 0.75rem 1.5rem;
        font-family: var(--font-heading);
        font-size: 0.875rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        text-decoration: none;
        box-shadow: var(--shadow-draft);
        transition: all 0.2s;
    }

    .cta-button:hover {
        transform: translate(2px, 2px);
        box-shadow: var(--shadow-draft-hover);
    }

    .cta-icon {
        width: 1.125rem;
        height: 1.125rem;
    }

    /* ============================================
       SIDEBAR TOC
       ============================================ */
    .roadmap-toc {
        display: none;
    }

    @media (min-width: 1024px) {
        .roadmap-toc {
            display: block;
            width: 18rem;
            min-width: 18rem;
            height: calc(100vh - 74px);
            position: sticky;
            top: 74px;
            overflow-y: auto;
            border-left: 2px solid var(--arch-ink);
            background-color: var(--arch-paper);
        }
    }

    .toc-content {
        padding: 1.5rem;
    }

    .toc-header {
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--arch-line);
    }

    .toc-title {
        font-family: var(--font-heading);
        font-weight: 800;
        text-transform: uppercase;
        color: var(--arch-ink);
        font-size: 0.8rem;
        letter-spacing: 0.05em;
    }

    .toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .toc-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.3rem 0.5rem;
        font-family: var(--font-body);
        font-size: 0.8125rem;
        color: var(--arch-ink-light);
        text-decoration: none;
        border-left: 2px solid transparent;
        transition: all 0.2s;
        line-height: 1.4;
    }

    .toc-item:hover {
        color: var(--arch-brick);
        background-color: rgba(231, 229, 223, 0.3);
    }

    .toc-item.active {
        color: var(--arch-brick);
        border-left-color: var(--arch-brick);
        font-weight: 600;
    }

    .toc-back {
        display: inline-flex;
        align-items: center;
        font-family: var(--font-mono);
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.75rem;
    }

    .back-icon {
        width: 0.875rem;
        height: 0.875rem;
        margin-right: 0.375rem;
    }

    /* TOC status dots */
    .toc-dot {
        width: 0.5rem;
        height: 0.5rem;
        flex-shrink: 0;
        border: 2px solid var(--arch-ink);
    }

    .toc-dot-completed {
        background-color: var(--arch-ink);
    }

    .toc-dot-active {
        background-color: var(--arch-brick);
    }

    .toc-dot-planned {
        background-color: var(--arch-paper);
    }

    .toc-dot-future {
        background-color: var(--arch-shape);
        border-style: dashed;
        border-color: var(--arch-ink-light);
    }

    .toc-dot-milestone {
        background-color: var(--arch-brick);
        transform: rotate(45deg);
    }

    /* ============================================
       MILESTONE
       ============================================ */
    .timeline-milestone {
        padding-bottom: 3rem;
    }

    .node-milestone {
        position: absolute;
        left: -2.95rem;
        top: 0.5rem;
        width: 1.75rem;
        height: 1.75rem;
        background-color: var(--arch-brick);
        border: 4px solid var(--arch-ink);
        transform: rotate(45deg);
        z-index: 2;
    }

    .milestone-card {
        background-color: var(--arch-ink);
        border: 2px solid var(--arch-ink);
        box-shadow: 4px 4px 0px 0px var(--arch-brick);
        padding: 1.25rem 1.5rem;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    @media (min-width: 768px) {
        .milestone-card {
            padding: 1.5rem 2rem;
        }
    }

    .milestone-card:hover {
        transform: translate(-2px, -2px);
        box-shadow: 2px 2px 0px 0px var(--arch-brick);
    }

    .milestone-content {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    @media (min-width: 768px) {
        .milestone-content {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }
    }

    .milestone-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .milestone-icon {
        width: 2rem;
        height: 2rem;
        color: var(--arch-brick);
        flex-shrink: 0;
    }

    .milestone-label {
        display: block;
        font-family: var(--font-mono);
        font-size: 0.6875rem;
        font-weight: 700;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--arch-line);
        margin-bottom: 0.125rem;
    }

    .milestone-title {
        font-family: var(--font-heading);
        font-size: 1.25rem;
        font-weight: 800;
        color: var(--arch-paper);
        text-transform: uppercase;
        letter-spacing: 0.02em;
        margin: 0;
        line-height: 1.2;
    }

    @media (min-width: 768px) {
        .milestone-title {
            font-size: 1.5rem;
        }
    }

    .milestone-badge {
        display: inline-flex;
        align-items: center;
        border: 2px solid var(--arch-brick);
        background-color: var(--arch-brick);
        color: var(--arch-paper);
        padding: 0.5rem 1rem;
        font-family: var(--font-mono);
        font-size: 0.8125rem;
        font-weight: 700;
        text-transform: uppercase;
        box-shadow: 2px 2px 0px 0px rgba(41, 37, 36, 1);
        white-space: nowrap;
        flex-shrink: 0;
    }

    /* ============================================
       MILESTONE — DONE STATE
       ============================================ */
    .node-milestone-done {
        background-color: var(--arch-ink-light);
    }

    .milestone-card-done {
        position: relative;
        overflow: hidden;
        box-shadow: 4px 4px 0px 0px var(--arch-ink-light);
    }

    .milestone-card-done:hover {
        box-shadow: 2px 2px 0px 0px var(--arch-ink-light);
    }

    .milestone-checkmark {
        position: absolute;
        right: -0.75rem;
        top: -1.5rem;
        width: 7rem;
        height: 7rem;
        color: var(--arch-brick);
        opacity: 0.9;
        transform: rotate(12deg);
        pointer-events: none;
        z-index: 20;
        filter: drop-shadow(2px 2px 0px rgba(41, 37, 36, 0.3));
    }

    @media (min-width: 768px) {
        .milestone-checkmark {
            right: -1rem;
            top: -2rem;
            width: 8rem;
            height: 8rem;
        }
    }

    .milestone-info-done {
        opacity: 0.7;
    }

    .milestone-badge-done {
        background-color: var(--arch-ink-light);
        border-color: var(--arch-ink-light);
    }

    /* ============================================
       STABILIZATION CARD (GAUGE)
       ============================================ */
    .stabilization-card {
        display: flex;
        flex-direction: column;
        border: 2px solid var(--arch-ink);
        box-shadow: var(--shadow-draft);
        background-color: var(--arch-surface);
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .stabilization-card:hover {
        transform: translate(-2px, -2px);
        box-shadow: 8px 8px 0px 0px rgba(41, 37, 36, 1);
    }

    @media (min-width: 768px) {
        .stabilization-card {
            flex-direction: row;
        }
    }

    .stabilization-info {
        flex: 1;
        padding: 1.5rem;
        background-color: var(--arch-surface);
    }

    @media (min-width: 768px) {
        .stabilization-info {
            padding: 2rem;
        }
    }

    .stabilization-label {
        display: block;
        font-family: var(--font-mono);
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--arch-ink-light);
        margin-bottom: 0.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid rgba(41, 37, 36, 0.1);
    }

    .stabilization-title {
        font-family: var(--font-heading);
        font-size: 1.375rem;
        font-weight: 800;
        color: var(--arch-ink);
        text-transform: uppercase;
        letter-spacing: 0.02em;
        margin: 0 0 0.75rem 0;
        line-height: 1.2;
    }

    .stabilization-description {
        font-family: var(--font-body);
        font-size: 0.9375rem;
        color: var(--arch-ink-light);
        line-height: 1.6;
        margin: 0 0 1.5rem 0;
    }

    .stabilization-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: 2px solid var(--arch-ink);
        background-color: var(--arch-paper);
        padding: 0.25rem 0.75rem;
        font-family: var(--font-mono);
        font-size: 0.6875rem;
        font-weight: 700;
        color: var(--arch-ink);
        text-transform: uppercase;
        box-shadow: 2px 2px 0px 0px rgba(41, 37, 36, 1);
    }

    .stabilization-pulse {
        width: 0.5rem;
        height: 0.5rem;
        background-color: #FACC15;
        border-radius: 50%;
        animation: pulse-dot 2s infinite;
    }

    @keyframes pulse-dot {
        0% { opacity: 1; }
        50% { opacity: 0.3; }
        100% { opacity: 1; }
    }

    /* Gauge panel */
    .stabilization-gauge {
        width: 100%;
        border-top: 2px solid var(--arch-ink);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: var(--arch-paper);
        background-image:
            linear-gradient(var(--arch-line) 1px, transparent 1px),
            linear-gradient(90deg, var(--arch-line) 1px, transparent 1px);
        background-size: 10px 10px;
    }

    @media (min-width: 768px) {
        .stabilization-gauge {
            width: 16rem;
            min-width: 16rem;
            border-top: none;
            border-left: 2px solid var(--arch-ink);
        }
    }

    .gauge-container {
        position: relative;
        width: 100%;
        max-width: 12rem;
        background-color: var(--arch-surface);
        border: 2px solid var(--arch-ink);
        border-radius: 999px 999px 0 0;
        padding: 0.5rem 0.5rem 0;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }

    .gauge-svg {
        width: 100%;
        height: auto;
        display: block;
        filter: drop-shadow(1px 1px 0px rgba(41, 37, 36, 0.1));
    }

    .gauge-baseline {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: var(--arch-ink);
    }

    /* Needle animation */
    @keyframes stabilize-needle {
        0% { transform: rotate(-50deg); }
        40% { transform: rotate(-20deg); }
        60% { transform: rotate(-30deg); }
        80% { transform: rotate(10deg); }
        100% { transform: rotate(35deg); }
    }

    .gauge-needle {
        transform-origin: 50px 50px;
        animation: stabilize-needle 2.5s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    .gauge-label {
        margin-top: 1rem;
        background-color: var(--arch-ink);
        color: var(--arch-paper);
        padding: 0.25rem 0.75rem;
        font-family: var(--font-mono);
        font-size: 0.625rem;
        font-weight: 700;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        text-align: center;
        border: 2px solid var(--arch-ink);
    }
</style>

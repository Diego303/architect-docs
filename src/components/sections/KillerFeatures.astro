---
import FeatureCard from '../ui/FeatureCard.astro';
import CodeFigure from '../ui/CodeFigure.astro';

const features = [
    {
        title: "Multi-Modelo, Cero Lock-in",
        iconPath: "M8 7h12M8 12h12M8 17h12M4 7h.01M4 12h.01M4 17h.01",
        description: "Usa cualquier LLM sin atarte a un proveedor. OpenAI, Anthropic, Google, DeepSeek, Mistral, Ollama — o cualquier API compatible con OpenAI. Cambia de modelo con un flag.",
    },
    {
        title: "El Agente Decide Cuándo Terminar",
        iconPath: "M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z",
        description: "El agente trabaja hasta que decide que terminó. Los límites de seguridad (budget, timeout) son watchdogs: cuando saltan, piden al agente un cierre limpio con resumen de qué hizo y qué queda pendiente.",
    },
    {
        title: "Verificación Automática Post-Edición",
        iconPath: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4",
        description: "Cada edición dispara automáticamente linter, formatter y type checker. Si algo falla, el error vuelve al agente como feedback para que lo corrija — sin intervención humana.",
    },
    {
        title: "Hecho para Headless",
        iconPath: "M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",
        description: "Headless-first: cada decisión de diseño está pensada para funcionar sin supervisión. En CI/CD, en cron jobs, en scripts, dentro de un Makefile. Exit codes semánticos y logs JSON.",
    },
    {
        title: "Control de Costes Integrado",
        iconPath: "M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
        description: "Cada llamada al LLM se rastrea: tokens, coste por paso, coste acumulado. Pon límites de presupuesto y el agente se detendrá limpiamente cuando los alcance.",
    },
    {
        title: "Conecta vía MCP",
        iconPath: "M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1",
        description: "Conéctate a servidores MCP para que el agente use herramientas externas: bases de datos, APIs, GitHub, Jira. Las tools MCP se descubren automáticamente y funcionan como nativas.",
    },
];
---

<section id="features" class="features-section">
    <div class="features-container">
        <div class="section-header">
            <h2 class="section-title">Características Principales</h2>
            <div class="section-line"></div>
        </div>

        <div class="features-grid">
            {features.map(feature => (
                <FeatureCard title={feature.title} iconPath={feature.iconPath}>
                    <p>{feature.description}</p>
                </FeatureCard>
            ))}
        </div>

        <!-- Highlighted feature: Terminal workflow -->
        <div class="feature-highlight">
            <div class="highlight-text">
                <h3 class="highlight-title">Tools Potentes para el Agente</h3>
                <p class="highlight-desc">
                    El agente no solo genera código: lee el codebase, busca patrones, ejecuta comandos, y
                    verifica su propio trabajo. Cada tool está diseñada para dar al LLM el contexto justo
                    que necesita sin desperdiciar tokens.
                </p>
                <div class="tool-list">
                    <div class="tool-group">
                        <h4 class="tool-group-label">Lectura</h4>
                        <ul class="tool-items">
                            <li><code>read_file</code> <span>Archivos con rangos parciales</span></li>
                            <li><code>search_code</code> <span>Búsqueda regex con contexto</span></li>
                            <li><code>grep</code> <span>Búsqueda rápida en múltiples archivos</span></li>
                            <li><code>find_files</code> <span>Descubre archivos por patrón</span></li>
                        </ul>
                    </div>
                    <div class="tool-group">
                        <h4 class="tool-group-label">Escritura</h4>
                        <ul class="tool-items">
                            <li><code>write_file</code> <span>Crea archivos nuevos</span></li>
                            <li><code>edit_file</code> <span>Edición quirúrgica (str_replace)</span></li>
                            <li><code>apply_patch</code> <span>Diffs complejos multi-hunk</span></li>
                        </ul>
                    </div>
                    <div class="tool-group">
                        <h4 class="tool-group-label">Ejecución</h4>
                        <ul class="tool-items">
                            <li><code>run_command</code> <span>Shell con timeout y captura</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <CodeFigure title="Figura 1 — Flujo del agente">
                <div class="workflow-line"><span class="wf-icon">&#128214;</span> read_file <span class="wf-arrow">&rarr;</span> src/auth/provider.py <span class="wf-meta">(145 líneas)</span></div>
                <div class="workflow-line"><span class="wf-icon">&#128214;</span> read_file <span class="wf-arrow">&rarr;</span> src/routes/login.py <span class="wf-meta">(89 líneas)</span></div>
                <div class="workflow-line"><span class="wf-icon">&#128295;</span> edit_file <span class="wf-arrow">&rarr;</span> src/auth/provider.py <span class="wf-meta">(+12 -3)</span></div>
                <div class="workflow-line"><span class="wf-icon">&#128221;</span> write_file <span class="wf-arrow">&rarr;</span> src/auth/jwt_handler.py <span class="wf-meta">(67 líneas)</span></div>
                <div class="workflow-line"><span class="wf-icon">&#128295;</span> edit_file <span class="wf-arrow">&rarr;</span> src/routes/login.py <span class="wf-meta">(+8 -2)</span></div>
                <div class="workflow-line"><span class="wf-icon">&#128221;</span> write_file <span class="wf-arrow">&rarr;</span> tests/test_jwt.py <span class="wf-meta">(54 líneas)</span></div>
                <div class="workflow-line"><span class="wf-icon">&#128421;&#65039;</span> run_command <span class="wf-arrow">&rarr;</span> pytest tests/test_jwt.py -q <span class="wf-result">&#10003; 4/4 passed</span></div>
                <div class="workflow-line"><span class="wf-icon">&#128269;</span> lint <span class="wf-arrow">&rarr;</span> ruff check src/auth/ <span class="wf-result">&#10003; sin errores</span></div>
                <div class="workflow-separator"></div>
                <div class="workflow-result"><span class="wf-result">&#10003;</span> Completado (8 pasos, 14.2s, $0.032)</div>
            </CodeFigure>
        </div>
    </div>
</section>

<style>
    .features-section {
        max-width: 80rem;
        margin: 0 auto;
        padding: 5rem 1.5rem;
        border-top: 2px solid var(--arch-line);
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .section-title {
        font-family: var(--font-heading);
        font-size: 1.875rem;
        color: var(--arch-ink);
        font-weight: 800;
        margin: 0;
        white-space: nowrap;
    }

    .section-line {
        height: 4px;
        background-color: var(--arch-ink);
        flex-grow: 1;
    }

    .features-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
        margin-bottom: 4rem;
    }

    @media (min-width: 768px) {
        .features-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .features-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    /* Feature Highlight — Tools section */
    .feature-highlight {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2.5rem;
        align-items: start;
        background-color: var(--arch-surface);
        border: 2px solid var(--arch-ink);
        padding: 2.5rem;
        box-shadow: var(--shadow-draft);
    }

    @media (min-width: 1024px) {
        .feature-highlight {
            grid-template-columns: 1fr 1fr;
        }
    }

    .highlight-title {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--arch-ink);
        text-transform: uppercase;
        letter-spacing: 0.02em;
        margin: 0 0 1rem 0;
    }

    .highlight-desc {
        font-size: 1rem;
        line-height: 1.7;
        color: var(--arch-ink-light);
        margin: 0 0 1.5rem 0;
    }

    .tool-list {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
    }

    .tool-group-label {
        font-family: var(--font-heading);
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--arch-brick);
        margin: 0 0 0.5rem 0;
    }

    .tool-items {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 0.375rem;
    }

    .tool-items li {
        font-size: 0.875rem;
        color: var(--arch-ink-light);
        display: flex;
        align-items: baseline;
        gap: 0.5rem;
    }

    .tool-items code {
        font-family: var(--font-mono);
        font-size: 0.8125rem;
        color: var(--arch-ink);
        font-weight: 500;
        background-color: var(--arch-shape);
        padding: 0.125rem 0.375rem;
        border: 1px solid var(--arch-line);
        white-space: nowrap;
    }

    .tool-items span {
        color: var(--arch-ink-light);
    }

    /* Workflow lines inside CodeFigure */
    .workflow-line {
        padding: 0.125rem 0;
    }

    .wf-icon {
        display: inline-block;
        width: 1.5rem;
        text-align: center;
        font-style: normal;
    }

    .wf-arrow {
        color: var(--arch-ink-light);
        margin: 0 0.25rem;
    }

    .wf-meta {
        color: var(--arch-ink-light);
        font-size: 0.75rem;
    }

    .wf-result {
        color: var(--arch-brick);
        font-weight: 500;
    }

    .workflow-separator {
        border-top: 1px dashed var(--arch-line);
        margin: 0.75rem 0;
    }

    .workflow-result {
        font-weight: 700;
        color: var(--arch-ink);
    }
</style>

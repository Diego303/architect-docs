---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';
import Card from '../../components/ui/Card.astro';

const docs = await getCollection('docs');
const sortedDocs = docs.sort((a, b) => {
    if (a.data.order && b.data.order) {
        return a.data.order - b.data.order;
    }
    return a.slug.localeCompare(b.slug);
});
---

<Layout>
    <Navbar />

    <main class="hub-main">
        <div class="hub-container">
            <div class="hub-header">
                <h1 class="hub-title">Documentaci&oacute;n</h1>
                <div class="hub-line"></div>
            </div>

            <div class="search-wrapper">
                <input
                    type="text"
                    id="docs-search"
                    class="search-input"
                    placeholder="Buscar en la documentaci&oacute;n..."
                    autocomplete="off"
                />
            </div>

            <div class="card-grid" id="docs-grid">
                {sortedDocs.map(doc => (
                    <div
                        class="card-wrapper"
                        data-title={doc.data.title || doc.slug}
                        data-description={doc.data.description || ''}
                    >
                        <Card
                            title={doc.data.title || doc.slug}
                            href={`${import.meta.env.BASE_URL}docs/${doc.slug}`}
                            iconPath={doc.data.icon}
                            class="h-full"
                        >
                            {doc.data.description || "Documentaci\u00f3n t\u00e9cnica detallada sobre este m\u00f3dulo del sistema Architect."}
                        </Card>
                    </div>
                ))}
            </div>

            <p class="no-results" id="no-results">No se encontraron resultados.</p>
        </div>
    </main>

    <Footer />
</Layout>

<script>
document.addEventListener('astro:page-load', () => {
    const input = document.getElementById('docs-search') as HTMLInputElement | null;
    const grid = document.getElementById('docs-grid');
    const noResults = document.getElementById('no-results');
    if (!input || !grid || !noResults) return;

    const cards = Array.from(grid.querySelectorAll<HTMLElement>('.card-wrapper'));

    input.addEventListener('input', () => {
        const query = input.value.toLowerCase().trim();
        let visible = 0;

        cards.forEach(card => {
            const title = (card.dataset.title || '').toLowerCase();
            const desc = (card.dataset.description || '').toLowerCase();
            const match = !query || title.includes(query) || desc.includes(query);
            card.style.display = match ? '' : 'none';
            if (match) visible++;
        });

        noResults.style.display = visible === 0 ? '' : 'none';
    });
});
</script>

<style>
    .hub-main {
        min-height: calc(100vh - 74px - 85px);
        padding: 4rem 1.5rem;
    }

    .hub-container {
        max-width: 80rem;
        margin: 0 auto;
    }

    .hub-header {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 2.5rem;
    }

    .hub-title {
        font-family: var(--font-heading);
        font-size: 1.875rem;
        color: var(--arch-ink);
        font-weight: 800;
        margin: 0;
        white-space: nowrap;
    }

    .hub-line {
        height: 4px;
        background-color: var(--arch-ink);
        flex-grow: 1;
    }

    /* Search */
    .search-wrapper {
        margin-bottom: 3rem;
        max-width: 36rem;
    }

    .search-input {
        width: 100%;
        padding: 0.75rem 1rem;
        font-family: var(--font-body);
        font-size: 1rem;
        color: var(--arch-ink);
        background-color: var(--arch-surface);
        border: 2px solid var(--arch-ink);
        box-shadow: var(--shadow-draft);
        outline: none;
        transition: box-shadow 0.15s, transform 0.15s;
    }

    .search-input::placeholder {
        color: var(--arch-ink-light);
    }

    .search-input:focus {
        transform: translate(2px, 2px);
        box-shadow: var(--shadow-draft-hover);
    }

    /* Card grid */
    .card-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    @media (min-width: 768px) {
        .card-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1024px) {
        .card-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    .card-wrapper {
        display: flex;
    }

    /* No results */
    .no-results {
        display: none;
        text-align: center;
        color: var(--arch-ink-light);
        font-size: 1.125rem;
        padding: 3rem 0;
    }
</style>
